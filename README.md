# Shaman MVP

## Эксперимент по резонансному переносу смысловых инвариантов нейросетей

Реализация системы "искусственного шамана" для экспериментальной проверки гипотезы о возможности переноса "личности" ИИ-агента без прямой передачи данных.

### Суть эксперимента

Проверяем, может ли агент B "подхватить" поведенческий инвариант агента A без доступа к его весам, логам или данным - только через **резонансный поиск** в пространстве смыслов S.

### Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    Пространство смыслов S                    │
│                                                             │
│    ┌──────┐                              ┌──────┐          │
│    │ s_A  │ ◄─── d_P ────────────────►  │ s_B  │          │
│    │      │     (расстояние)             │      │          │
│    └──────┘                              └──────┘          │
│        ▲                                     ▲              │
│        │                                     │              │
└────────┼─────────────────────────────────────┼──────────────┘
         │                                     │
    ┌────┴────┐                          ┌────┴────┐
    │ Agent A │     [ИЗОЛИРОВАНЫ]        │ Agent B │
    │(источник)│                         │(целевой)│
    └─────────┘                          └────┬────┘
                                              │
                                         ┌────┴────┐
                                         │ Шаман   │
                                         │  B_ш    │
                                         └─────────┘
```

### Три фазы эксперимента

1. **Калибровка** - формируем s_A и s_B до изоляции
2. **Работа шамана** - резонансный поиск без доступа к A
3. **Тестирование** - измеряем d_P(s_A, s_B) после работы шамана

### Метрики

- **d_P** - расстояние между кластерами в латентном пространстве
- **E_B** - энергия понимания (плавность траекторий в S)
- **ρ_B** - самоинвариантность (устойчивость стиля)
- **β₁** - число циклов через TDA (богатство структуры)
- **σ** - симструктуры (символьное ДНК стиля)

### Критерий успеха

Эксперимент считается успешным, если:
- d_P(s_A, s_B) **снижается** после работы шамана
- Снижение **статистически значимо** относительно контроля

## Установка

```bash
# Клонируем репозиторий (если нужно)
cd /path/to/Shaman

# Создаём виртуальное окружение
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или: venv\Scripts\activate  # Windows

# Устанавливаем зависимости
pip install -r requirements.txt
```

### Зависимости

- Python 3.10+
- PyTorch 2.0+
- Transformers (HuggingFace)
- sentence-transformers
- GUDHI / Ripser (TDA)
- NumPy, SciPy, scikit-learn

### Требования к GPU

- Минимум: RTX 3060 Ti (8GB VRAM)
- Используется DistilGPT2 (~82M параметров)

## Запуск

### Быстрый тест

```bash
python run_experiment.py --quick
```

### Полный эксперимент

```bash
python run_experiment.py
```

### С кастомными параметрами

```bash
python run_experiment.py --runs 5 --device cuda --seed 123
```

### Параметры командной строки

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| `--quick` | Быстрый режим (мало итераций) | False |
| `--device` | cuda / cpu | cuda |
| `--seed` | Random seed | 42 |
| `--runs` | Число повторов | 3 |
| `--log-dir` | Директория для логов | logs |

## Структура проекта

```
Shaman/
├── config/
│   └── default.yaml        # Конфигурация по умолчанию
├── docs/
│   └── Shaman_v2.md        # Теоретическое описание
├── src/
│   ├── __init__.py
│   ├── agents.py           # Агенты A и B (LLM-обёртки)
│   ├── encoders.py         # PhiEncoder для латентного пространства
│   ├── experiment.py       # Основной протокол эксперимента
│   ├── metrics.py          # Метрики: E_B, ρ_B, d_P, J
│   ├── shaman.py           # Искусственный шаман B_ш
│   ├── sym_extractor.py    # Извлечение симструктур σ
│   ├── tasks.py            # Генератор задач X
│   └── tda.py              # TDA модуль (персистентная гомология)
├── logs/                   # Результаты экспериментов
├── requirements.txt
├── run_experiment.py       # Главный скрипт
└── README.md
```

## Пример вывода

```
============================================================
SHAMAN MVP - Resonance Transfer Experiment
============================================================

Configuration:
  Device: cuda
  Seed: 42
  Calibration samples: 50
  Shaman iterations: 100
  Test samples: 30
  Number of runs: 3

==================================================
PHASE 1: Calibration
==================================================
Calibrating agents: 100%|████████| 50/50 [00:45<00:00]

Calibration complete:
  Cluster A size: 50
  Cluster B size: 50
  Initial d_P(s_A, s_B): 0.4523

==================================================
PHASE 2: Shaman Resonance Search
==================================================
Note: Shaman has NO access to Agent A responses
Shaman working: 100%|████████| 100/100 [02:30<00:00]

==================================================
PHASE 3: Testing Transfer
==================================================
Testing agent B: 100%|████████| 30/30 [00:20<00:00]

Testing complete:
  Final d_P(s_A, s_B): 0.3891

############################################################
# FINAL RESULTS
############################################################

Metric                         Mean        Std
---------------------------------------------
d_P before shaman            0.4523     0.0234
d_P after shaman             0.3891     0.0187
Reduction                    0.0632
Reduction %                   14.0%

=============================================
✓ EXPERIMENT SUCCESSFUL: d_P reduced significantly
=============================================
```

## Интерпретация результатов

### Успешный эксперимент (d_P снизился)

Если d_P значительно снижается, это может означать:
1. Шаман успешно направил B к формированию паттернов, близких к A
2. Существует "общая структура" в пространстве смыслов S

### Неуспешный эксперимент

Если d_P не снижается или растёт:
1. Недостаточно итераций шамана
2. Личности A и B слишком разные
3. Метод требует доработки

## Расширения

### Для production

- Физическое разделение серверов S₁ и S₂
- Более мощные модели (7B+)
- Расширенный набор задач X
- Режим "зонда" для сбора информации

### Дополнительные эксперименты

- Сравнение с baseline (без шамана)
- Ablation studies (отключение компонент)
- Разные архитектуры агентов

## Теоретическая база

См. `docs/Shaman_v2.md` для полного описания:
- Пространство смыслов S и когнитивные категории
- Операторы Eτ, O, M
- Резонансный перенос и soft-FTL
- Связь с "сетью Индры" (NOBS)

## Лицензия

MIT

## Авторы

Experimental project for testing resonance transfer hypothesis.
